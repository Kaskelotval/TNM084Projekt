<!doctype html>
<html>
	<head>
		<title>learningthree.js boiler plate for three.js</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
			
		<script src="vendor/three.js/Three.js"></script>
		<script src="vendor/three.js/Detector.js"></script>
		<!-- https://github.com/mrdoob/stats.js -->
		<script src="vendor/three.js/Stats.js"></script>
		<script type="text/javascript" src="dat.gui.js"></script>
		<script src="vendor/threex/THREEx.screenshot.js"></script>
		<script src="vendor/threex/THREEx.FullScreen.js"></script>
		<script src="vendor/threex/THREEx.WindowResize.js"></script>
		<script src="vendor/three.js/TrackballControls.js"></script>
		
		<link  href="css/main.css" rel="stylesheet"/>
	</head>
<body>
	<!-- three.js container -->
    <div id="container"></div>
	<!-- info on screen display -->
	<div id="info">
		<div class="top">

		</div>
		<div class="bottom" id="inlineDoc" >
		</div> 
	</div> 

  <div id="container"></div>
    <script src="js/three.min.js"></script>
    <script src="shaders/vertex.js"></script>
    <script src="shaders/fragment.js"></script>
    <script src="shaders/seaVertex.js"></script>
    <script src="shaders/seaFragment.js"></script>
    <script src="shaders/landVertex.js"></script>
    <script src="shaders/landFragment.js"></script>

    <script>
        var container;
        var camera, scene, renderer, cameraControls;
        var uniforms, light1, light2, sphere;
        var landMeshRef, seaMeshRef;
        var size_var, a_var, b_var, c_var, height_var, speed_var;
        var date = new Date();   
        var disp = 2000;     

        //GUI


        init();
        animate();

        function init() {

          	//initial values
          	size_var = {size_var:5000};
          	height_var = {height_var:5.0};
          	a_var = {a_var:0.01};
          	b_var = {b_var:0.01};
          	c_var = {c_var:0.5};
          	speed_var = {speed_var:1.0};
          	//GUI
			var gui = new dat.GUI();
			gui.add(size_var,'size_var',100,10000);
			gui.add(a_var, 'a_var', 0.001, 0.04);
			gui.add(b_var, 'b_var', 0.001, 0.04);
			gui.add(c_var, 'c_var', -1.0, 1.0);
			gui.add(height_var, 'height_var', 0.0, 15.0);
			gui.add(speed_var, 'speed_var', 0.0, 50.0);

			//RENDERER
          	renderer = new THREE.WebGLRenderer({alpha: true});
			renderer.setClearColor( 0xffffff );
            
			renderer.setSize( window.innerWidth, window.innerHeight );
            container = document.getElementById( 'container' );

           	scene = new THREE.Scene();

			camera	= new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1, 10000000 );


			camera.position.set(200, 200, 200);
			camera.up = new THREE.Vector3(0,0,1);

			camera.lookAt(new THREE.Vector3(0,0,0));

			cameraControls	= new THREE.TrackballControls( camera, renderer.domElement)	
			scene.add(camera);

			// transparently support window resize


			//Lights
			light1 = new THREE.PointLight(0xffffff, 1.0);
			var lightBall = new THREE.Mesh( new THREE.SphereGeometry( 0.3, 16, 16 ), new THREE.MeshBasicMaterial( { color: 0x0000FF } ) );
			light1.position.set(0.0,0.0,1.0);
			//light1.add(lightBall);
			scene.add(light1);
			var light1Col = new THREE.Vector3(0.2,0.2,0.2);

			light2 = new THREE.PointLight(0xffffff, 1.0);
			var lightBall = new THREE.Mesh( new THREE.SphereGeometry( 10, 10, 10 ), new THREE.MeshBasicMaterial( { color: 0xFF0000 } ) );
			light2.position.set(3.0,2.0,0.0);			
			light2.add(lightBall);
			scene.add(light2);
			var light2Col = new THREE.Vector3(1.0,0.2,0.1);


			var diff = 0.5;
			var diffVec = new THREE.Vector3(diff,diff,diff);

			//sea
            suniforms = 	{
	                u_time: { type: "f", value: 1.0 },
	                u_resolution: { type: "v2", value: new THREE.Vector2() },
	                u_mouse: { type: "v2", value: new THREE.Vector2() },
	                u_light1Pos: { type: "v3", value: light1.position},
	                u_light1Col: { type: "v3", value: light1Col},
	                u_light2Pos: { type: "v3", value: light2.position},
	                u_light2Col: { type: "v3", value: light2Col},
	                u_diffuseLight: { type: "v3", value: diffVec},

            	};

            var geometry = new THREE.PlaneGeometry( size_var.size_var, size_var.size_var, 400,400 );
            var material = new THREE.ShaderMaterial( {
                uniforms: suniforms,
                vertexShader: seaVertex,
                fragmentShader: seaFragment,
            } );
            material.transparent = true;
			var sea = new THREE.Mesh( geometry, material );

            sea.position.z = -0;	            
			scene.add( sea );
        	console.log(camera.position);
        	console.log(light1.position);

			//landscape
			luniforms = {
	                u_time: { type: "f", value: 1.0 },
	                u_resolution: { type: "v2", value: new THREE.Vector2() },
	                u_mouse: { type: "v2", value: new THREE.Vector2() },
	                u_light1Pos: { type: "v3", value: light1.position},
	                u_light1Col: { type: "v3", value: light1Col},
	                u_light2Pos: { type: "v3", value: light2.position},
	                u_light2Col: { type: "v3", value: light2Col},
	                u_diffuseLight: { type: "v3", value: diffVec},
	                u_height: {type: "f", value: height_var.height_var},
	                u_a: {type: "f", value: a_var.a_var},
	                u_b: {type: "f", value: b_var.b_var},
	                u_c: {type: "f", value: c_var.c_var},
	                u_speed: {type: "f", value: speed_var.speed_var},

			};

            landgeometry = new THREE.PlaneGeometry( size_var.size_var, size_var.size_var, 400,400);
            landmaterial = new THREE.ShaderMaterial( {
                uniforms: luniforms,
                vertexShader: landVertex,
                fragmentShader: landFragment,
            } );
			var land = new THREE.Mesh( landgeometry, landmaterial );
            land.position.x = 100;
            land.position.y = 100;			
			land.rotation.x = Math.PI*3/2;
            land.position.z = -3;	            
			scene.add( land );

            container.appendChild( renderer.domElement );

            onWindowResize();
            window.addEventListener( 'resize', onWindowResize, false );

            document.onmousemove = function(e){
              suniforms.u_mouse.value.x = e.pageX
              suniforms.u_mouse.value.y = e.pageY
            }
        }

        function onWindowResize( event ) {
        	camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.render(scene,camera);
            suniforms.u_resolution.value.x = window.innerWidth;
            suniforms.u_resolution.value.y = window.innerHeight;
        }

        function animate() {	        	
            requestAnimationFrame( animate );
            render();
        }

        function render() {
 			cameraControls.update();
            suniforms.u_time.value += 0.05*speed_var.speed_var;
            luniforms.u_time.value += 0.05*speed_var.speed_var;
               	//Move lights
        	//light1.position.set(camera.position.x,camera.position.y,camera.position.z);
        	//light1.position.x = Math.sin(suniforms.u_time.value)*(disp);
        	//light1.position.y = Math.cos(suniforms.u_time.value)*(disp);
        	light2.position.x = Math.cos(suniforms.u_time.value*0.1)*disp;
        	light2.position.y = Math.sin(suniforms.u_time.value*0.1)*disp;
        	light2.position.z = 100.0;


            //Update Uniforms
            luniforms.u_a.value = a_var.a_var;
            luniforms.u_b.value = b_var.b_var;
            luniforms.u_c.value = c_var.c_var;
            luniforms.u_height.value = height_var.height_var;
            luniforms.u_speed.value = speed_var.speed_var;
            renderer.render( scene, camera );
        }
    </script>
</body>
</html>
